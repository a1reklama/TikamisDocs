## Функции приложения
В приложении клиент может делать следующие действия:
- Записаться на обслуживание
- Просмотреть свои записи на будущее (далее будут называться **предстоящие записи**)
- Просмотреть историю выполненных заказов (далее будет называться **сервисная история**)
- Оставлять отзывы об обслуживании. Отзыв может быть анонимный, если клиент захочет.

Есть дизайн [на фигме](https://www.figma.com/file/nWi1UCjspbGrjeG9UibgTV/TIKAMIS-IOS%2C-ANDROID?type=design&node-id=510%3A5557&mode=design&t=vlYpxb2gT1RvZThu-1), 
но он сильно отличается от того, какой интерфейс у приложения сейчас, 
т.к. после первой вёрстки по этому дизайну, было много правок заказчиком.  
Сейчас интерфейс приложения тоже немного устарел, о правках я напишу позже.  

## Последовательность записи и выполнения заказа
1. Пользователь в приложении авторизуется/регистрируется
2. Выбирает город, сервисный центр, набор услуг, дату и время
3. Там же пользователь может написать другие номер телефона / номер машины. Эта функция существует, чтобы клиент мог записать своих друзей/родственников через свой аккаунт.
4. После нажатия на кнопку "записаться", этот заказ сохраняется в систему.
5. За час до запланированного обслуживания, клиенту придёт ПУШ уведомление с напоминанием.
6. Когда клиент приедет на автосервис, ему придёт ПУШ с приглашением для заезда на пост. (Ещё будет приглашение на ТАБЛО очереди в автосервисе)
7. После заезда на пост, механик приступает к выполнению заказа. После окончания обслуживания, в приложении появится возможность показать QR код:
8. Механик пошлёт клиента на кассу оплачивать заказ. Клиент показывается QR код в приложении на кассе.
9. На кассе считывается QR код, в котором содержится информация обо всех услугах, номере машины и т.д.
10. После всех этий действий, заказ переносится из списка "предстоящих заказов" в "сервисную историю".

## Краткое описание методов

## Раздел Customer
- POST `mobile-api/customer/ask-sms` - Запросить смс для входа. Подробнее описан [здесь](Авторизация.md)
- POST `mobile-api/customer/login` - Ввести код из смс и тем самым завершить аутентификацию, получив авторизационные токены. Подробнее описан [здесь](Авторизация.md) 
- POST `mobile-api/customer/refresh` - Обновить токены, если от API приходит ошибка **401 Unauthorized**. [здесь](Авторизация.md)
- GET `mobile-api/customer/user_agreement.html` - Страница с пользовательским сообщением.
- GET `mobile-api/customer/qr-code` - получить QR Код (вкладка отдельная). [ссылка](#get-mobile-apicustomerqr-code)
- DELETE `mobile-api/customer/account` - удалить аккаунт и данные пользователя.

## Раздел CarCenter
- GET `mobile-api/carcenter/get-cities` - Получить список городов. Нужно для выбора на этапе записи.
- GET `mobile-api/carcenter/{city}` - Получить список автосервисов, которые есть в определенном городе. Для этапа заказа.
- GET `mobile-api/carcenter/{centerId}` - Получить список работ по городу и ID автосервиса. Для этапа заказа.

## Раздел Cart
- POST `mobile-api/cart` - добавить работу в корзину для заказа.
- GET `mobile-api/cart` - получить корзину клиента.
- DELETE `mobile-api/cart/{id}` - удалить услугу из корзины клиента.

## Раздел Order
- GET `mobile-api/order/available-time/{centerId}` - Получить временные окна для записи на обслуживание.
- POST `mobile-api/order` - создать заказ. 
- GET `mobile-api/order` - Получить **предстоящие** заказы.
- POST `mobile-api/order/get-history` - получить **сервисную историю**.
- DELETE `mobile-api/order` - отменить заказ.

## Раздел Work
- GET `mobile-api/work/all` - получить все услуги. Этот метод нужен для фильтрации на экране *Ремонт* -> *Сервисная история*
- GET `mobile-api/work/sale-info/{workId}` - получить информацию о 

## Раздел Notification
- GET `mobile-api/notification` - получить все уведомления.

## Раздел Review
- POST `mobile-api/review` - отправить отзыв.

## Ответ от сервера 409 Conflict
Если случилась какая-то непредсказуемая проблема, о которой нужно уведомить пользователя, то сообщение
об этой проблеме присылается сервером со статус кодом **409**.  

Ответ такого типа может прийти от ЛЮБОГО запроса, поэтому в приложении любой ответ от сервера с кодом **409** нужно как-то
обрабатывать и показывать сообщение пользователю в теле ответа.  
В отличие от всех остальных ответов сервера, этот приходит не в виде json, а в виде строки.  
Можно обрабатывать сообщения со статус кодом 409, например таким образом:
```js
let response = await fetch(URL+'/mobile-api/customer/qr-code');
if (response.status == 409)
   alert(await response.text());
// Появляется сообщение для пользователя. 
// В react native код будет другой, не помню, как там такое окно показать. 
```

## Подробное описание методов

#### GET `mobile-api/customer/qr-code`

Сам QR код вроде находится во вкладке QR код внизу.  
Зачем нужен QR код, я описал [здесь](#последовательность-записи-и-выполнения-заказа).
При вызове метода формат ответа будет следующим:
```json
{
   "result": "eyJJRCI6MjAwMDAwMDEsIkNBUiI6IkFBMDAxQSIsIlJFRyI6IjE4NiIsIk9ET01FVEVSIjoiMTI0NTQiLCJXT1JLUyI6W3si0KbQkS0wMDAwMjg4OSI6Miwi0KbQkS0wMDAwMjkwOSI6MSwi0KbQkS0wMDAwMjkyNyI6MX1dLCJIQVNIIjoiYzUwMWJkNDdiYzk4YTk5MGI0ZjkwMDljOGQ2NjBlNDllZTQ3MDhiYzNjNjE2ZjcxMzdhZGUyZDVkNmMxYzViMCJ9"
}
```
Эти данные нужно просто отрисовать в QR код.
Также, может прийти пустой ответ:
```json
{
  "result": ""
}
```
Это может означать, что сейчас у клиента нет заказов, для которых необходимо отображать QR код. 
В приложении сейчас это не заложено, там, кажется, QR код отображается всегда.

#### GET `mobile-api/carcenter/get-cities`
